---
title: "Veri Ä°nceleme"
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: true
    code-fold: false
    df-print: paged
    sidebar: haftalar
---

# ğŸ¯ AmaÃ§ {.unnumbered}

-   Bu derste temel amacÄ±mÄ±z, veri dÃ¼zenleme ve Ã¶zetleme tekniklerini uygulamalÄ± olarak Ã¶ÄŸrenmektir.

-   Ã–zellikle, deÄŸiÅŸkenler arasÄ±ndaki iliÅŸkileri incelerken verilerin farklÄ± dÃ¼zeylerde (toplam vs. alt gruplar) nasÄ±l farklÄ± gÃ¶rÃ¼nebileceÄŸini keÅŸfedeceÄŸiz.

-   Bu baÄŸlamda Simpson Paradoksu ve verilerin uygun ÅŸekilde dÃ¼zenlenip gruplanmamasÄ± durumunda nasÄ±l yanÄ±ltÄ±cÄ± sonuÃ§lara ulaÅŸÄ±labileceÄŸini gÃ¶stermesi aÃ§Ä±sÄ±ndan gÃ¼Ã§lÃ¼ bir Ã¶rnektir.

-   Anscombeâ€™un DÃ¶rtlÃ¼sÃ¼ ise, aynÄ± Ã¶zet istatistiklere sahip veri setlerinin gÃ¶rselleÅŸtirilmeden yanlÄ±ÅŸ yorumlanabileceÄŸini ortaya koyar.

Veri dÃ¼zenlemenin Ã¶nemi, sadece â€œdoÄŸru hesaplamaâ€ yapmak deÄŸil; aynÄ± zamanda hangi deÄŸiÅŸkenlerin kontrol edilmesi gerektiÄŸini fark ederek daha anlamlÄ± sonuÃ§lar Ã§Ä±karmaktÄ±r.

**ğŸ” Uygulamalar**

-   Simpson Paradoksu (UCBadmit Ã–rneÄŸi)
    -   Genel oranlar ile alt grup oranlarÄ±nÄ± karÅŸÄ±laÅŸtÄ±rma
    -   KarÄ±ÅŸtÄ±rÄ±cÄ± (confounding) deÄŸiÅŸkenlerin etkisini gÃ¶rme
    -   Veri dÃ¼zenlemenin ve doÄŸru gruplamanÄ±n Ã¶nemini tartÄ±ÅŸma

<!-- -->

-   Anscombeâ€™un DÃ¶rtlÃ¼sÃ¼
    -   AynÄ± Ã¶zet istatistiklere sahip farklÄ± veri setlerini keÅŸfetme
    -   Ã–zet istatistikler (ortalama, sd, korelasyon, regresyon) ile gÃ¶rselleÅŸtirme sonuÃ§larÄ±nÄ± karÅŸÄ±laÅŸtÄ±rma
    -   Veriyi gÃ¶rselleÅŸtirmeden sadece Ã¶zet istatistiklere gÃ¼venmenin sakÄ±ncalarÄ±nÄ± tartÄ±ÅŸma
    -   Dersin simspon paradoksu kÄ±smÄ± OpenIntro'nun [Introduction to Modern Statistics](https://openintro.shinyapps.io/ims-01-data-02/#section-simpsons-paradox) bÃ¶lÃ¼mÃ¼nden uyarlanmÄ±ÅŸtÄ±r.

# Simpson Paradoxu

-   Simpson Paradoksu, bir gruptaki iki deÄŸiÅŸken arasÄ±ndaki iliÅŸkinin, alt gruplara bÃ¶lÃ¼ndÃ¼ÄŸÃ¼nde ortaya Ã§Ä±ktÄ±ÄŸÄ±, kaybolduÄŸu veya tersine dÃ¶ndÃ¼ÄŸÃ¼ istatistiksel bir olgudur.

-   Ã–rneÄŸin, iki deÄŸiÅŸken bir grupta pozitif iliÅŸkili olabilir, ancak tÃ¼m alt gruplarda baÄŸÄ±msÄ±z veya hatta negatif iliÅŸkili olabilir.

-   Paradoksu sergileyen vakalar matematik ve olasÄ±lÄ±k teorisi aÃ§Ä±sÄ±ndan problemsizdir, ancak yine de birÃ§ok insanÄ± ÅŸaÅŸÄ±rtmaktadÄ±r.

-   Bir iliÅŸkiyi incelerken Ã¶nemli bir deÄŸiÅŸkeni dikkate almamak **Simpson paradoksu** ile sonuÃ§lanabilir.

-   Simpson paradoksu, aÃ§Ä±klayÄ±cÄ± bir deÄŸiÅŸkenin ihmal edilmesinin, baÅŸka bir aÃ§Ä±klayÄ±cÄ± deÄŸiÅŸken ile yanÄ±t deÄŸiÅŸkeni arasÄ±ndaki iliÅŸkinin Ã¶lÃ§Ã¼sÃ¼ Ã¼zerinde yaratabileceÄŸi etkiyi gÃ¶stermektedir.

-   ÃœÃ§Ã¼ncÃ¼ bir deÄŸiÅŸkenin analize dahil edilmesi, diÄŸer iki deÄŸiÅŸken arasÄ±ndaki gÃ¶rÃ¼nÃ¼r iliÅŸkiyi deÄŸiÅŸtirebilir

ğŸ“¦ Ã–rnek Senaryo: Ã‡ok DeÄŸiÅŸkenli Ä°liÅŸkiler

GÃ¼nlÃ¼k alÄ±nan kalori miktarÄ± ile kalp saÄŸlÄ±ÄŸÄ± arasÄ±ndaki iliÅŸkiyi dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼mÃ¼zde, bu iki deÄŸiÅŸkenin tek baÅŸÄ±na incelenmesi yanÄ±ltÄ±cÄ± olabilir. Ã‡Ã¼nkÃ¼ kiÅŸinin yaÅŸÄ± ve fiziksel kondisyonu gibi baÅŸka faktÃ¶rler de bu iliÅŸkiyi etkiler.

ğŸ‘‰ GerÃ§ek dÃ¼nyada deÄŸiÅŸkenler arasÄ±ndaki iliÅŸkiler genellikle Ã§ok boyutludur ve bu nedenle analizlerde birden fazla deÄŸiÅŸkeni dikkate almak gerekir.

### Berkeley'deki cinsiyete dayalÄ± kabul oranlarÄ±:

-   "Berkeley'deki California Ãœniversitesi'ne 1973 sonbaharÄ±nda yapÄ±lan lisansÃ¼stÃ¼ kabullere iliÅŸkin toplu veriler incelendiÄŸinde, kadÄ±n baÅŸvuru sahiplerine karÅŸÄ± aÃ§Ä±k ama yanÄ±ltÄ±cÄ± bir Ã¶nyargÄ± Ã¶rÃ¼ntÃ¼sÃ¼ gÃ¶rÃ¼lmektedir.

-   Veriler altÄ± bÃ¶lÃ¼mden gelmektedir. Gizlilik iÃ§in bÃ¶lÃ¼mler A-F olarak kodlanmÄ±ÅŸtÄ±r.

-   Elimizde baÅŸvuru sahibinin kadÄ±n mÄ± erkek mi olduÄŸu ve kabul edilip edilmediÄŸine dair bilgiler var.

-   Ä°lk olarak, kabul edilen erkeklerin yÃ¼zdesinin genel olarak kadÄ±nlardan gerÃ§ekten daha yÃ¼ksek olup olmadÄ±ÄŸÄ±nÄ± deÄŸerlendireceÄŸiz. Daha sonra, her bÃ¶lÃ¼m iÃ§in aynÄ± yÃ¼zdeyi hesaplayacaÄŸÄ±z.

```{r}
library(dsbox)
library(dplyr)
ucbadmit %>%
  count(gender)

```

```{r}

ucbadmit %>%
  count(dept)

```

```{r}

ucbadmit %>%
  count(admit)
```

Genel cinsiyet daÄŸÄ±lÄ±mÄ± hakkÄ±nda ne sÃ¶yleyebilirsiniz?

> ğŸ“Œ Ä°pucu: AÅŸaÄŸÄ±daki olasÄ±lÄ±klarÄ± hesaplayÄ±n: $P(Kabul | Erkek)$ ve $P(Kabul | KadÄ±n)$.

```{r}
ucbadmit %>%
  count(gender, admit)
```

```{r ucbadmit-overall-prop}
ucbadmit %>%
  count(gender, admit) %>%
  group_by(gender) %>%
  mutate(prop_admit = n / sum(n))
```

-   $P(Kabul | KadÄ±n)$ = 0.304
-   $P(Kabul | Erkek)$ = 0.445

```{r}

library(ggplot2)
ggplot(ucbadmit, aes(y = gender, fill = admit)) +
  geom_bar(position = "fill") + 
  labs(title = "Admit by gender",
       y = NULL, x = NULL)
```

-   Departmanlara gÃ¶re cinsiyet daÄŸÄ±lÄ±mÄ± hakkÄ±nda ne sÃ¶yleyebilirsiniz?

```{r}
ucbadmit %>%
  count(dept, gender, admit)
```

```{r}
library(tidyr)
ucbadmit %>%
  count(dept, gender, admit) %>%
  pivot_wider(names_from = dept, values_from = n)
```

```{r}
ggplot(ucbadmit, aes(y = gender, fill = admit)) +
  geom_bar(position = "fill") +
  facet_wrap(. ~ dept) +
  scale_x_continuous(labels = scales::label_percent()) +
  labs(title = "cinsiyet ve bÃ¶lÃ¼mlere gÃ¶re kabul",
       x = NULL, y = NULL, fill = NULL) +
  theme(legend.position = "bottom")
```

```{r}
ucbadmit %>%
  count(dept, gender, admit) %>%
  group_by(dept, gender) %>%
  mutate(
    n_applied  = sum(n),
    prop_admit = n / n_applied
    ) %>%
  filter(admit == "Admitted") %>%
  rename(n_admitted = n) %>%
  dplyr::select(-admit) %>%
  print(n = 12)
```

Tabloya bakÄ±ldÄ±ÄŸÄ±nda kadÄ±n Ã¶ÄŸrenciler, Ã¼niversitenin en bÃ¼yÃ¼k 6 bÃ¶lÃ¼mÃ¼nÃ¼n 4â€™Ã¼nde erkek Ã¶ÄŸrencilere gÃ¶re daha fazla kabul almÄ±ÅŸtÄ±r. Yani A, B, D ve F bÃ¶lÃ¼mlerine kabul gÃ¶ren erkek sayÄ±sÄ± kadÄ±n sayÄ±sÄ±na gÃ¶re daha azdÄ±r. ÅÃ¶yle ki erkekler en fazla Ã¶ÄŸrenci kabul edilen bÃ¶lÃ¼me baÅŸvuruyu daha fazla yaparken kÄ±z Ã¶ÄŸrenciler ise en az Ã¶ÄŸrenci kabul edilen bÃ¶lÃ¼me daha fazla baÅŸvuru yapmÄ±ÅŸtÄ±r. Bu sebeple grup yÃ¼zdeleri ile toplam yÃ¼zdeleri birbirinden farklÄ±lÄ±k gÃ¶stermektedir. Konuyu pekiÅŸtirmek iÃ§in baÅŸka bir Ã¶rnekle devam edelim.

ğŸ”¹ Genel olarak: Erkeklerin kabul edilme olasÄ±lÄ±ÄŸÄ± daha yÃ¼ksekti.

ğŸ”¹ Ã‡oÄŸu bÃ¶lÃ¼m iÃ§inde: KadÄ±nlarÄ±n kabul edilme olasÄ±lÄ±ÄŸÄ± daha yÃ¼ksekti.

ğŸ”¹ BÃ¶lÃ¼m etkisi kontrol edildiÄŸinde: Cinsiyet ile kabul edilme durumu arasÄ±ndaki iliÅŸki tersine dÃ¶ndÃ¼.

ğŸ“Œ OlasÄ± neden:

KadÄ±nlar, kabul oranÄ± daha dÃ¼ÅŸÃ¼k olan rekabetÃ§i bÃ¶lÃ¼mlere baÅŸvurma eÄŸilimindeydi.

Erkekler ise, kabul oranÄ± daha yÃ¼ksek olan daha az rekabetÃ§i bÃ¶lÃ¼mlere baÅŸvurma eÄŸilimindeydi.

ğŸ‘‰ GÃ¶rÃ¼ldÃ¼ÄŸÃ¼ gibi, erkeklerin genel kabul oranÄ± daha yÃ¼ksek Ã§Ä±kmÄ±ÅŸ olsa da bÃ¶lÃ¼m bilgisi dikkate alÄ±ndÄ±ÄŸÄ±nda, Ã§oÄŸu bÃ¶lÃ¼mde kadÄ±nlarÄ±n kabul edilme olasÄ±lÄ±ÄŸÄ± aslÄ±nda daha yÃ¼ksektir. Bu durumu Simpson paradoksu olarak adlandÄ±rÄ±yoruz.

âš ï¸ Bu Ã§eliÅŸkili bulguyu yalnÄ±zca baÅŸvurulan bÃ¶lÃ¼m bilgisi analize eklendiÄŸinde keÅŸfedebildik. Bu tÃ¼r Ã¶rnekler, bir araÅŸtÄ±rmada yÃ¼zeyde ilgisiz gibi gÃ¶rÃ¼nen ancak potansiyel olarak karÄ±ÅŸtÄ±rÄ±cÄ± (confounding) etkisi olabilecek deÄŸiÅŸkenlerin dikkate alÄ±nmasÄ±nÄ±n ve toplanmasÄ±nÄ±n Ã¶nemini vurgular.

**Ä°ki deÄŸiÅŸken arasÄ±ndaki iliÅŸki**

```{r echo=FALSE, message=FALSE}
df <- tribble(
  ~x, ~y, ~z,
  2,   4,  "A",
  3,   3,  "A",
  4,   2,  "A",
  5,   1,  "A",
  6,   11, "B",
  7,   10, "B",
  8,   9,  "B",
  9,   8,  "B"
)
df
```

```{r echo=FALSE, out.width="100%"}
ggplot(df) +
  geom_point(aes(x = x, y = y), color = "darkgray", size = 5) +
  theme_minimal()
```

```{r echo=FALSE, out.width="100%"}
ggplot(data = df) +
  geom_point(aes(x = x, y = y), color = "darkgray", size = 5) +
  geom_smooth(aes(x = x, y = x), color = "darkgray") +
  theme_minimal()
```

**ÃœÃ§ deÄŸiÅŸken arasÄ±ndaki iliÅŸki**

```{r echo=FALSE, out.width="100%"}
ggplot(data = df) +
  geom_point(aes(x = x, y = y, color = z), size = 5) +
  geom_smooth(aes(x = x, y = x), method = "lm", color = "darkgray") +
  theme_minimal()
```

```{r echo=FALSE, out.width="100%"}
ggplot(data = df) +
  geom_point(aes(x = x, y = y, color = z), size = 5) +
  geom_smooth(aes(x = x, y = x), method = "lm", color = "darkgray") +
  geom_smooth(aes(x = x, y = y, color = z), method = "lm") +
  theme_minimal()
```

# Anscombe'un DÃ¶rtlÃ¼sÃ¼

`anscombe_quartet` veri setinin amacÄ±, verilerinizi gÃ¶rselleÅŸtirmenin Ã¶nemli olduÄŸu noktasÄ±nÄ± vurgulamaya yardÄ±mcÄ± olmaktÄ±r. Francis Anscombe bu dÃ¶rt veri setini, istatistiksel Ã¶zet Ã¶lÃ§Ã¼mlerin tek baÅŸÄ±na iki deÄŸiÅŸken (burada x ve y) arasÄ±ndaki tam iliÅŸkiyi yakalayamayacaÄŸÄ±nÄ± gÃ¶stermek iÃ§in oluÅŸturmuÅŸtur. Anscombe, Ã¶zet istatistikleri hesaplamadan Ã¶nce verileri gÃ¶rselleÅŸtirmenin Ã¶nemini vurgulamÄ±ÅŸtÄ±r.

-   Veri seti 1, x ve y arasÄ±nda doÄŸrusal bir iliÅŸkiye sahiptir
-   Veri Seti 2, x ve y arasÄ±nda doÄŸrusal olmayan bir iliÅŸki olduÄŸunu gÃ¶stermektedir
-   Veri seti 3, x ve y arasÄ±nda tek bir aykÄ±rÄ± deÄŸer ile doÄŸrusal bir iliÅŸkiye sahiptir
-   Veri seti 4, etkili deÄŸer olarak iÅŸlev gÃ¶ren tek bir aykÄ±rÄ± deÄŸer ile x ve y arasÄ±nda hiÃ§bir iliÅŸki gÃ¶stermemektedir.

```{r}
library(datasets)
datasets::anscombe
```

-   deÄŸiÅŸkenlerin ortalamalarÄ±

```{r}
library(dplyr)
library(knitr)
colMeans(anscombe) %>% kable(digits=2)
```

-   deÄŸiÅŸkenlerin standart sapmalarÄ±

```{r}
apply(anscombe,2,sd) %>% kable(digits=2)
```

-   deÄŸiÅŸkenler arasÄ± korelasyonlar

```{r}
cor(anscombe[,1:4],anscombe[,5:8]) %>% kable(digits=2)
```

-   regresyon denklemleri

```{r}
ff <- y ~ x
mods <- setNames(as.list(1:4), paste0("lm", 1:4))
for(i in 1:4) {
  ff[2:3] <- lapply(paste0(c("y","x"), i), as.name)
  mods[[i]] <- lmi <- lm(ff, data = anscombe)
  print(anova(lmi))
}
```

```{r}
sapply(mods, coef)
```

-   Ã–zetle
-   $\overline{X}$: 9
-   $sd_{\overline{X}}$: 3.32
-   $\overline{Y}$: 7.5
-   $sd_{\overline{Y}}$: 4.125
-   $cor_{XY}$: 0.816
-   Regresyon denklemleri: $y = 3 + 0.5x$
-   AÃ§Ä±klanan varyans $R^2$ : 0.67

```{r}
library(tidyverse)
library(quartets)

ggplot(anscombe_quartet, aes(x = x, y = y)) +
  geom_point() + 
  geom_smooth(method = "lm", formula = "y ~ x") +
  facet_wrap(~dataset)
```

```{r}
anscombe_quartet |>
  group_by(dataset) |>
  summarise(mean_x = mean(x),
            sd_x = sd(x),
            mean_y = mean(y),
            sd_y = sd(y),
            cor = cor(x, y)) |>
  knitr::kable(digits = 2)
```

-   bu sayfayÄ± da `r emo::ji("link")`[inceleyebilirsiniz.](https://public.tableau.com/app/profile/nir.smilga/viz/AnscombesQuartet_17079175167910/Anscombesquartet)

-   Bunun gibi diÄŸer Ã¶rnekler iÃ§in `r emo::ji("link")`[baÄŸlantÄ±yÄ±](https://r-causal.github.io/quartets/) inceleyebilirsiniz.

## ğŸ’¡ Uygulama GÃ¶revi {.unnumbered}

palmerpenguins paketinden penguins veri setini yÃ¼kleyin.

Veri seti Antarktikaâ€™daki penguenlerin tÃ¼rÃ¼, ad, boy, aÄŸÄ±rlÄ±k, yÃ¼zgeÃ§ uzunluÄŸu, cinsiyet vb.bilgilerini iÃ§erir.

-   penguenlerin vÃ¼cut kitle indeksini (body_mass_g / flipper_length_mm) veri setine ekleyin

-   Bu yeni deÄŸiÅŸken iÃ§in tÃ¼rler gÃ¶re ortalama, standart sapma, minimum ve maksimum deÄŸerlerini hesaplayÄ±n.

```{r}
#| echo: false
#| 
library(palmerpenguins)
library(dplyr)
library(ggplot2)

data("penguins")

penguins2 <- penguins %>%
  mutate(bmi = body_mass_g / flipper_length_mm)

penguins2 %>%
  group_by(species) %>%
  summarise(mean_bmi = mean(bmi, na.rm = TRUE))

ggplot(penguins2, aes(x = species, y = bmi, fill = species)) +
  geom_boxplot()

```

# ğŸ“š Ã–dev {.unnumbered}

ğŸ”— Derste yaptÄ±klarÄ±mÄ±zÄ±n tekrarÄ±nÄ± aÅŸaÄŸÄ±daki iki bÃ¶lÃ¼mÃ¼ tekrarlayÄ±nÄ±z

ğŸ”— [Language of data](https://openintro.shinyapps.io/ims-01-data-04/)

ğŸ”— [Language of data](https://openintro.shinyapps.io/ims-01-data-02/)
